<html>
	<header>
		<h1>Durian Recognition System</h1>
		</header>
	<head>
		<style>
		input[type=button], input[type=file], input[type=reset] {
   			background-color: white;
    		border: none;
    		color: #0099ff;
    		padding: 4px 8px;
    		text-decoration: none;
    		margin: 4px 2px;
    		cursor: pointer;
		}
		body {
		    background: lightblue url("Blue Black.jpg") no-repeat fixed center;
		    font-family: "Myriad Pro", Myriad, "Liberation Sans", "Nimbus Sans L", "Helvetica Neue", Helvetica, Arial, sans-serif;
		    font-size: 20px;
		    text-align: center;
		}

		h1 {
		    color: white;
		    text-align: center;
		}

		p {
		    font-family: "Myriad Pro", Myriad, "Liberation Sans", "Nimbus Sans L", "Helvetica Neue", Helvetica, Arial, sans-serif;
		    font-size: 20px;
		    color: white;
		}

		</style>
	<!-- Load TensorFlow.js -->
		<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.13.3/dist/tf.min.js"> </script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<p>_____________________________________________________</p>
		<p>This web-app identifies up to 4 classes of Durio zibethinus cultivars</p>
		<p id="Line_1"></p>
		<p id="Line_2"></p>
		<p style="font-size:50px" id="Line_3"></p>
		<!-- Place your code in the script tag below. You can also use an external .js file -->
		<script>
			var json=$.getJSON('http://192.168.1.29:8080/model.json');
			var jsonStr=JSON.stringify(json);
			document.getElementById("Line_1").innerHTML = "The type of cultivar is: ";
		</script>
	</head>
	<body>
		<div class="row">
        	<!––Upload Functionality––>
        	<input type='file' accept='image/*' onchange='openFile(event)' size="60"/>
        </div>
        <div class="col-6">
            <!––Predict Button––>
            <button type="button" id="predict-button" >Predict</button>
        </div>
        <p>
        	_____________________________________________________
        </p>
    	<div style="position: absolute; font-size:15px; bottom: 0; right:10px; color: white">
    		Marcus Lim 2018, All rights reserved
    	</div>
        <img id='output' style="height:300px; width:300px">
		<script>
				var openFile = function(file) {
    				var input = file.target;
					var reader = new FileReader();
    				reader.onload = function(){
      					var dataURL = reader.result;
      					var output = document.getElementById('output');
      					output.src = dataURL;
    					};
    				reader.readAsDataURL(input.files[0]);
  				};
				async function model_loading(tensor){
					const model= await tf.loadModel('http://192.168.1.29:8080/model.json');
					document.getElementById("Line_2").innerHTML = "Processing..";
    				console.log("Model loaded button");
    				console.log(model);
    				let prediction = await model.predict(tensor);
    				prediction.print();
    				list=["\tD13","\tD24","\tD175","\tD197"];
    				output_data=prediction.dataSync();
    				var x=0;
    				var mx=output_data[0];
    				if (output_data[1]>mx){
    					x=1;
    					mx=output_data[1];
    				}
    				if (output_data[2]>mx){
    					x=2;
    					mx=output_data[2]
    				}
    				if (output_data[3]>mx) {
    					x=3;
    				}
    				document.getElementById("Line_2").innerHTML = " ";
    				document.getElementById("Line_3").innerHTML = list[x];
 
				}
				$("#predict-button").click(async function(){
    
    				//Initialize the image object
    				var image=document.getElementById('output');
    				document.getElementById("Line_2").innerHTML = "Processing.";
    				console.log(image);
    				//convert the image object to a tensor by resizing it and Normalizing it using the ImageNet mean RGB values
    				let tensor = tf.fromPixels(image,1).resizeNearestNeighbor([200,200]).toFloat();
    				console.log(tensor);
    				tensor=tensor.reshape([1,200,200,1]);
    				console.log(tensor);
    				model_loading(tensor);
    				//	model_loading();
            		//define the Prediction object and put a future event for prediction.
					//let prediction = await model.predict(tensor);
					//prediction.print();
    				});
    	</script>
	</body>
</html>